groups:
  - name: mysql_alerts
    rules:
      - alert: MySQLDown
        expr: mysql_up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "MySQL is down on {{ $labels.instance }}"
          description: "MySQL/MariaDB service is not responding"

      - alert: MySQLTooManyConnections
        expr: mysql_global_status_threads_connected / mysql_global_variables_max_connections * 100 > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "MySQL connections high on {{ $labels.instance }}"
          description: "{{ $value | printf \"%.1f\" }}% of max connections used"

      - alert: MySQLConnectionsCritical
        expr: mysql_global_status_threads_connected / mysql_global_variables_max_connections * 100 > 95
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "MySQL connections critical on {{ $labels.instance }}"
          description: "{{ $value | printf \"%.1f\" }}% of max connections used"

      - alert: MySQLSlowQueries
        expr: rate(mysql_global_status_slow_queries[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "MySQL slow queries detected on {{ $labels.instance }}"
          description: "{{ $value | printf \"%.2f\" }} slow queries per second"
