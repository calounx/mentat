# ============================================================================
# CHOM Prometheus Configuration
# ============================================================================
# Scrapes metrics from all exporters and services
# ============================================================================

global:
  scrape_interval: 15s
  scrape_timeout: 10s
  evaluation_interval: 15s
  external_labels:
    cluster: 'chom-test'
    environment: 'docker'

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - localhost:9093

# Load rules once and periodically evaluate them
rule_files:
  - '/etc/prometheus/rules/*.yml'

# Scrape configurations
scrape_configs:
  # ========================================================================
  # Prometheus itself
  # ========================================================================
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'
          tier: 'observability'

  # ========================================================================
  # Alertmanager
  # ========================================================================
  - job_name: 'alertmanager'
    static_configs:
      - targets: ['localhost:9093']
        labels:
          service: 'alertmanager'
          tier: 'observability'

  # ========================================================================
  # Observability Stack - Node Exporter
  # ========================================================================
  - job_name: 'node-exporter-observability'
    static_configs:
      - targets: ['localhost:9100']
        labels:
          service: 'node-exporter'
          tier: 'observability'
          host: 'observability-stack'

  # ========================================================================
  # Web Application Stack - Node Exporter
  # ========================================================================
  - job_name: 'node-exporter-web'
    static_configs:
      - targets: ['chom_web:9100']
        labels:
          service: 'node-exporter'
          tier: 'application'
          host: 'web-stack'

  # ========================================================================
  # Nginx Exporter
  # ========================================================================
  - job_name: 'nginx-exporter'
    static_configs:
      - targets: ['chom_web:9113']
        labels:
          service: 'nginx'
          tier: 'application'
          component: 'webserver'

  # ========================================================================
  # MySQL Exporter
  # ========================================================================
  - job_name: 'mysql-exporter'
    static_configs:
      - targets: ['chom_web:9104']
        labels:
          service: 'mysql'
          tier: 'application'
          component: 'database'

  # ========================================================================
  # PHP-FPM Exporter
  # ========================================================================
  - job_name: 'php-fpm-exporter'
    static_configs:
      - targets: ['chom_web:9253']
        labels:
          service: 'php-fpm'
          tier: 'application'
          component: 'runtime'

  # ========================================================================
  # Redis Exporter (if added)
  # ========================================================================
  # - job_name: 'redis-exporter'
  #   static_configs:
  #     - targets: ['chom_web:9121']
  #       labels:
  #         service: 'redis'
  #         tier: 'application'
  #         component: 'cache'

  # ========================================================================
  # Grafana Alloy (Web Application)
  # ========================================================================
  - job_name: 'alloy-web'
    static_configs:
      - targets: ['chom_web:12345']
        labels:
          service: 'alloy'
          tier: 'application'
          component: 'collector'

  # ========================================================================
  # Grafana
  # ========================================================================
  - job_name: 'grafana'
    static_configs:
      - targets: ['localhost:3000']
        labels:
          service: 'grafana'
          tier: 'observability'

  # ========================================================================
  # Loki
  # ========================================================================
  - job_name: 'loki'
    static_configs:
      - targets: ['localhost:3100']
        labels:
          service: 'loki'
          tier: 'observability'

  # ========================================================================
  # Tempo
  # ========================================================================
  - job_name: 'tempo'
    static_configs:
      - targets: ['localhost:3200']
        labels:
          service: 'tempo'
          tier: 'observability'
