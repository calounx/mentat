# ============================================================================
# CHOM Production Environment Configuration
# For deployment on landsraad_tst VPS with mentat_tst Observability Stack
# ============================================================================
#
# DEPLOYMENT ARCHITECTURE:
# - CHOM Application: landsraad_tst VPS
# - Observability Stack: mentat_tst VPS (Prometheus, Loki, Tempo, Grafana)
#
# NETWORK REQUIREMENTS:
# - landsraad_tst must be able to reach mentat_tst on ports:
#   - 9090 (Prometheus API - for querying)
#   - 3100 (Loki API - for log queries)
#   - 4318 (Tempo OTLP - for trace export)
#   - 3000 (Grafana - for dashboard embedding)
#
# - mentat_tst must be able to reach landsraad_tst on ports:
#   - 80/443 (CHOM web application)
#   - /metrics endpoint for Prometheus scraping
#
# ============================================================================

# ----------------------------------------------------------------------------
# APPLICATION SETTINGS
# ----------------------------------------------------------------------------
APP_NAME="CHOM"
APP_ENV=production
APP_KEY=                         # REQUIRED: Run `php artisan key:generate`
APP_DEBUG=false                  # CRITICAL: Must be false in production
APP_URL=https://chom.yourdomain.com

# Localization
APP_LOCALE=en
APP_FALLBACK_LOCALE=en

# Password Hashing
BCRYPT_ROUNDS=12

# ----------------------------------------------------------------------------
# LOGGING CONFIGURATION (Promtail/Loki Integration)
# ----------------------------------------------------------------------------
# Use 'observability' for file-based JSON logs (Promtail scrapes these)
# Use 'production' for stdout JSON logs (container deployments)
LOG_CHANNEL=observability
LOG_LEVEL=info

# Channels included in observability stack
LOG_OBSERVABILITY_CHANNELS=json_file,daily

# ----------------------------------------------------------------------------
# DATABASE CONFIGURATION
# ----------------------------------------------------------------------------
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=chom
DB_USERNAME=chom
DB_PASSWORD=                     # REQUIRED: Set secure password

# ----------------------------------------------------------------------------
# SESSION CONFIGURATION
# ----------------------------------------------------------------------------
SESSION_DRIVER=redis
SESSION_LIFETIME=120
SESSION_ENCRYPT=true
SESSION_SECURE_COOKIE=true
SESSION_SAME_SITE=strict
SESSION_EXPIRE_ON_CLOSE=true

# ----------------------------------------------------------------------------
# CACHE & QUEUE CONFIGURATION
# ----------------------------------------------------------------------------
CACHE_STORE=redis
QUEUE_CONNECTION=redis
BROADCAST_CONNECTION=log

# ----------------------------------------------------------------------------
# REDIS CONFIGURATION
# ----------------------------------------------------------------------------
REDIS_CLIENT=phpredis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=                  # REQUIRED if Redis auth enabled
REDIS_PORT=6379

REDIS_DB=0
REDIS_CACHE_DB=1
REDIS_QUEUE_DB=2
REDIS_SESSION_DB=3

# ----------------------------------------------------------------------------
# OBSERVABILITY STACK (mentat_tst Integration)
# ----------------------------------------------------------------------------
# Master switch - set to true to enable all observability features
OBSERVABILITY_ENABLED=true

# ----------------------------------------------------------------------------
# PROMETHEUS - Metrics Collection
# ----------------------------------------------------------------------------
PROMETHEUS_ENABLED=true

# Prometheus server URL on mentat_tst (for querying metrics)
# Use internal IP or hostname that landsraad_tst can reach
PROMETHEUS_URL=http://10.0.0.X:9090

# Metric namespace prefix
PROMETHEUS_NAMESPACE=chom

# Basic auth for /metrics endpoint (RECOMMENDED for security)
PROMETHEUS_AUTH_ENABLED=true
PROMETHEUS_AUTH_USERNAME=prometheus
PROMETHEUS_AUTH_PASSWORD=              # REQUIRED: Set secure password

# ----------------------------------------------------------------------------
# LOKI - Log Aggregation
# ----------------------------------------------------------------------------
LOKI_ENABLED=true

# Loki server URL on mentat_tst
LOKI_URL=http://10.0.0.X:3100

# Note: Logs are collected by Promtail from JSON log files
# Set LOKI_PUSH_ENABLED=true only if using direct push (not recommended)
LOKI_PUSH_ENABLED=false

# ----------------------------------------------------------------------------
# TEMPO - Distributed Tracing
# ----------------------------------------------------------------------------
TEMPO_ENABLED=true

# Tempo OTLP endpoint on mentat_tst
TEMPO_ENDPOINT=http://10.0.0.X:4318

# OpenTelemetry configuration
OTEL_SERVICE_NAME=chom
OTEL_EXPORTER_OTLP_ENDPOINT=http://10.0.0.X:4318
OTEL_EXPORTER_OTLP_PROTOCOL=http/protobuf

# Sampling rate (0.1 = trace 10% of requests in production)
OTEL_TRACES_SAMPLER_ARG=0.1

# ----------------------------------------------------------------------------
# GRAFANA - Visualization
# ----------------------------------------------------------------------------
GRAFANA_ENABLED=true

# Grafana server URL on mentat_tst
GRAFANA_URL=http://10.0.0.X:3000

# API key for dashboard management (create in Grafana: Configuration > API Keys)
GRAFANA_API_KEY=

# ----------------------------------------------------------------------------
# ALERTMANAGER
# ----------------------------------------------------------------------------
ALERTING_ENABLED=true
ALERTMANAGER_URL=http://10.0.0.X:9093

# ----------------------------------------------------------------------------
# REQUEST TRACING & MONITORING
# ----------------------------------------------------------------------------
REQUEST_TRACING_ENABLED=true
SLOW_REQUEST_THRESHOLD=1000

# Metrics storage (uses Redis)
METRICS_STORAGE_DRIVER=redis
METRICS_STORAGE_PREFIX=chom_metrics:

# Internal monitoring
MONITORING_ENABLED=true
VPS_HEALTH_CHECK_ENABLED=true

# ----------------------------------------------------------------------------
# SECURITY SETTINGS
# ----------------------------------------------------------------------------
# CORS (set your actual frontend domain)
CORS_ALLOWED_ORIGINS=https://chom.yourdomain.com

# Sanctum API tokens
SANCTUM_TOKEN_EXPIRATION=60
SANCTUM_TOKEN_ROTATION_ENABLED=true
SANCTUM_STATEFUL_DOMAINS=chom.yourdomain.com

# Two-Factor Authentication
AUTH_2FA_ENABLED=true
AUTH_2FA_REQUIRED_ROLES=owner,admin
AUTH_2FA_GRACE_PERIOD_DAYS=7

# ----------------------------------------------------------------------------
# STRIPE (Production Keys)
# ----------------------------------------------------------------------------
STRIPE_KEY=pk_live_xxxxx
STRIPE_SECRET=sk_live_xxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxx

# ----------------------------------------------------------------------------
# DEVELOPMENT TOOLS (Disabled in Production)
# ----------------------------------------------------------------------------
TELESCOPE_ENABLED=false
DEBUGBAR_ENABLED=false

# ============================================================================
# POST-DEPLOYMENT CHECKLIST
# ============================================================================
#
# 1. Generate APP_KEY:
#    php artisan key:generate
#
# 2. Run migrations:
#    php artisan migrate --force
#
# 3. Configure Prometheus scrape on mentat_tst:
#    Add to prometheus.yml:
#    - job_name: 'chom'
#      basic_auth:
#        username: 'prometheus'
#        password: 'your-password'
#      static_configs:
#        - targets: ['landsraad-tst:443']
#          labels:
#            environment: 'production'
#      scheme: https
#      metrics_path: '/metrics'
#
# 4. Configure Promtail on landsraad_tst:
#    Scrape: /var/www/chom/storage/logs/app.json
#    Labels: job=chom, environment=production
#
# 5. Verify connectivity:
#    curl http://mentat-tst:9090/-/healthy
#    curl http://mentat-tst:3100/ready
#
# 6. Test metrics endpoint:
#    curl -u prometheus:password https://chom.yourdomain.com/metrics
#
# ============================================================================
